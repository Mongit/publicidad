(function(){var app=angular.module("app");var depArr=["$location","mapFactory","$anchorScroll"];depArr.push(function($location,mapFactory,$anchorScroll){var ctrl=this;ctrl.scrollTo=function(id){$location.hash(id);$anchorScroll()};ctrl.latitud=19.412288699925995;ctrl.longitud=-102.0718502998352;ctrl.getMap=function(){var mapa=mapFactory(ctrl.latitud,ctrl.longitud);mapa.placeMarker(ctrl.latitud,ctrl.longitud)};ctrl.getMap()});app.controller("AboutController",depArr)})();(function(){var app=angular.module("app");app.factory("adminsProxy",["proxyFactory","constants",function(proxyFactory,constants){var AdminsProxy=function(){this.signinProxy=proxyFactory(constants.server+"/admin/api/signin");this.signupProxy=proxyFactory(constants.server+"/admin/api/signup");this.proxy=proxyFactory(constants.server+"/admin/api/")};AdminsProxy.prototype.signin=function(model,success){this.signinProxy.save(model,success)};AdminsProxy.prototype.signup=function(model,success){this.signupProxy.save(model,success)};AdminsProxy.prototype.getAll=function(callback){this.proxy.getAll(callback)};AdminsProxy.prototype.delete=function(id,success){this.proxy.delete(id,success)};return new AdminsProxy}])})();(function(){var app=angular.module("app");app.controller("AppController",["$location","routeChecker","tokenStorage",function($location,routeChecker,tokenStorage){var model=this;var instancia=routeChecker();model.isPrivate=function(){return instancia.isPrivate()};model.isActive=function(path){return instancia.isActive(path)};model.logout=function(){tokenStorage.clearToken();$location.path("/");return false}}])})();(function(){var app=angular.module("app",["ngRoute","ngMessages","angularUtils.directives.dirPagination"]);app.config(["$routeProvider","$httpProvider",function($router,$httpProvider){$httpProvider.interceptors.push("httpInterceptor");$router.when("/",{templateUrl:"angular/views/todosPublico.html"});$router.when("/signin",{templateUrl:"angular/views/signin.html"});$router.when("/signup",{templateUrl:"angular/views/signup.html"});$router.when("/:negocio",{templateUrl:"angular/views/negocio.html"});$router.when("/publico/about",{templateUrl:"angular/views/about.html"});$router.when("/publico/contact",{templateUrl:"angular/views/contact.html"});$router.when("/error",{templateUrl:"angular/views/error.html"});$router.when("/publico/nuevo/:id",{templateUrl:"angular/views/nuevoPublico.html"});$router.when("/publico/signup",{templateUrl:"angular/views/signupPublico.html"});$router.when("/privado/ver/:id",{templateUrl:"angular/views/ver.html"});$router.when("/privado/todos",{templateUrl:"angular/views/todos.html"});$router.when("/privado/todos/usuarios",{templateUrl:"angular/views/todosUsuarios.html"});$router.when("/privado/todos/admin",{templateUrl:"angular/views/todosAdmin.html"});$router.when("/privado/editar/:id",{templateUrl:"angular/views/editar.html"}).otherwise({redirectTo:"/"})}])})();(function(){var app=angular.module("app");app.factory("constants",[function(){return{server:$("#hidServer").val()}}])})();(function(){var app=angular.module("app");app.controller("EmailFormController",["$http","$scope","constants","errorLog",function($http,$scope,constants,errorLog){var model=this;model.name="";model.email="";model.phone="";model.message="";model.waiting=false;model.clear=function(){model.name="";model.email="";model.phone="";model.message="";model.waiting=false;$scope.mailForm.$setPristine()};model.send=function(to){model.to=to;$http({method:"POST",url:constants.server+"/correo/",data:model,beforeSend:function(){model.waiting=true},complete:function(){model.waiting=false}}).then(function(){alert("Gracias, su mensage fué enviado con éxito. Prónto nos comunicarémos con usted.");model.clear()},errorLog)}}])})();(function(){var app=angular.module("app");var depArr=["$routeParams","$location","mapFactory","productosFactory","modelFactory","paginasProxy","linkFactory"];depArr.push(function($route,$location,mapFactory,productosFactory,modelFactory,paginasProxy,linkFactory){var ctrl=this;ctrl.empresaId=$route.id;var prod=productosFactory();var linkObj=linkFactory();var modelInstance=modelFactory();var getOne=function(id){paginasProxy.getOne(id,function(data,status,headers,config){var obj=modelInstance.getObjFromSubdocument(data);ctrl=modelInstance.copyObjToCtrl(obj,ctrl);var latitud=parseFloat(ctrl.lat);var longitud=parseFloat(ctrl.long);ctrl.mapa=mapFactory(latitud,longitud);ctrl.mapa.placeMarker(latitud,longitud);ctrl.mapa.getEventListener()})};getOne(ctrl.empresaId);ctrl.quitarLogo=function(){ctrl.logotipo=undefined};ctrl.quitarFoto=function(){ctrl.foto=undefined};ctrl.borrarMarker=function(){ctrl.mapa.borrarMarker()};ctrl.agregarProducto=function(){ctrl.producto=prod.agregarProducto(ctrl.productos,ctrl.producto)};ctrl.removerProducto=function(){ctrl.productos=prod.removerProducto(ctrl.productos,ctrl.remover)};ctrl.borrarProductos=function(){ctrl.productos=prod.borrarProductos(ctrl.productos)};ctrl.agregarLink=function(){ctrl.link=linkObj.agregarLink(ctrl.links,ctrl.link)};ctrl.removerLink=function(){ctrl.links=linkObj.removerLink(ctrl.links,ctrl.numLinkARemover)};ctrl.borrarLinks=function(){ctrl.links=linkObj.borrarLinks(ctrl.links)};ctrl.editar=function(){ctrl.lat=ctrl.mapa.getLat();ctrl.long=ctrl.mapa.getLong();paginasProxy.update(ctrl.empresaId,modelInstance.getModelFromCtrl(ctrl),function(data,status,headers,config){alert("Info enviada");$location.path("/privado/todos")})}});app.controller("EditarFormularioController",depArr)})();(function(){var app=angular.module("app");app.factory("errorLog",["$log","$location",function($log,$location){return function(data,status,headers,config,statusText){if(config){$log.error("%s %s %s",config.method,config.url,status)}else{$log.error("error")}$location.path("/error")}}])})();(function(){var app=angular.module("app");app.factory("httpInterceptor",["$q","$location","tokenStorage","routeChecker",function($q,$location,tokenStorage,routeChecker){return{request:function(request){var rCh=routeChecker();if(rCh.isPrivate()){var tokenObj=tokenStorage.getToken();if(tokenObj===undefined){$location.path("/signin")}}request.headers["x-access-token"]=tokenStorage.getAccessHeader();return request},requestError:function(rejection){return $q.reject(rejection)},response:function(response){return response},responseError:function(rejection){if(rejection.status===401){$location.path("/signin")}return $q.reject(rejection)}}}])})();(function(){var app=angular.module("app");app.factory("linkFactory",[function(){var LinkClass=function(){};LinkClass.prototype.removerLink=function(arr,link){var sonDiferentes=function sonDiferentes(element,index,array){return index!==link-1};arr=arr.filter(sonDiferentes);return arr};LinkClass.prototype.agregarLink=function(arr,link){if(link){arr.push(link);link=undefined;return link}};LinkClass.prototype.borrarLinks=function(links){links=[];return links};return function(){return new LinkClass}}])})();(function(){var app=angular.module("app");app.factory("mapFactory",["$window",function($window){var MapClass=function(latitud,longitud){this.google=$window.google;this.map=undefined;this.lat=latitud||undefined;this.long=longitud||undefined;this.myCenter=new $window.google.maps.LatLng(this.lat||19.4096,this.long||-102.052);this.markersArray=[];this.mapOptions=this.getMapOptions();this.document=$window.document.getElementById("googleMap");this.map=this.getMap();this.eventListener=undefined};MapClass.prototype.getMapOptions=function(){var that=this;return{center:that.myCenter,zoom:13,mapTypeId:that.google.maps.MapTypeId.ROADMAP}};MapClass.prototype.getMap=function(){var that=this;return new that.google.maps.Map(that.document,that.mapOptions)};MapClass.prototype.getEventListener=function(){var that=this;that.eventListener=that.google.maps.event.addListener(that.map,"click",function(event){that.manageEvent(event)})};MapClass.prototype.manageEvent=function(event){var that=this;that.lat=event.latLng.lat();that.long=event.latLng.lng();that.clearOverlays();that.placeMarker(event.latLng.lat(),event.latLng.lng())};MapClass.prototype.clearOverlays=function(){var that=this;for(var i=0;i<that.markersArray.length;i++){that.markersArray[i].setMap(null)}};MapClass.prototype.placeMarker=function(latitud,longitud){var that=this;var myMarkerPosition=undefined;myMarkerPosition=new that.google.maps.LatLng(latitud,longitud);var marker=new that.google.maps.Marker({position:myMarkerPosition,map:that.map});that.markersArray.push(marker)};MapClass.prototype.borrarMarker=function(){var that=this;that.lat=undefined;that.long=undefined;that.clearOverlays();that.markersArray=[]};MapClass.prototype.getLat=function(){var that=this;return that.lat};MapClass.prototype.getLong=function(){var that=this;return that.long};return function(latitud,longitud){return new MapClass(latitud,longitud)}}])})();(function(){var app=angular.module("app");app.factory("modelFactory",[function(){var ModelFactory=function(){};ModelFactory.prototype.getObjFromSubdocument=function(data){var obj={};if(data){obj.nombre=data.nombre;obj.logotipo=data.logotipo;obj.foto=data.foto;obj.colorBackground=data.colorBackground;obj.colorText=data.colorText;obj.textoIntro=data.textoIntro;obj.lat=data.lat;obj.long=data.long;obj.descripcion=data.descripcion;obj.horario=data.horario;obj.encargado=data.encargado;obj.tel=data.tel;obj.face=data.face;obj.flickr=data.flickr;obj.whats=data.whats;obj.links=data.links;obj.email=data.email;obj.productos=data.productos;obj.nota=data.nota;obj.numero=data.direccion.numero;obj.numeroInt=data.direccion.numeroInt;obj.calle=data.direccion.calle;obj.colonia=data.direccion.colonia;obj.cp=data.direccion.cp;obj.municipio=data.direccion.municipio;obj.estado=data.direccion.estado;obj.rubro=data.rubro.rubro;obj.userId=data._usuario._id;obj.noContrato=data._usuario.noContrato;obj.uniquename=data._usuario.uniquename;obj.cliente=data._usuario.cliente;obj.telCliente=data._usuario.telCliente;obj.correoCliente=data._usuario.email;obj.fechaContrato=data._usuario.fechaRegistro;obj.fechaVencimiento=data._usuario.fechaVencimiento;obj.pago=data._usuario.pago;obj.password=data._usuario.password}return obj};ModelFactory.prototype.copyObjToCtrl=function(obj,ctrl){for(var prop in obj){ctrl[prop]=obj[prop]}return ctrl};ModelFactory.prototype.getModelFromCtrl=function(ctrl){var model={};model.nombre=ctrl.nombre,model.logotipo=ctrl.logotipo,model.foto=ctrl.foto,model.colorBackground=ctrl.colorBackground,model.colorText=ctrl.colorText,model.textoIntro=ctrl.textoIntro,model.lat=ctrl.lat,model.long=ctrl.long,model.long=ctrl.long,model.descripcion=ctrl.descripcion,model.horario=ctrl.horario,model.encargado=ctrl.encargado,model.tel=ctrl.tel,model.face=ctrl.face,model.flickr=ctrl.flickr,model.whats=ctrl.whats,model.links=ctrl.links,model.email=ctrl.email,model.productos=ctrl.productos,model.nota=ctrl.nota,model.numero=ctrl.numero,model.numeroInt=ctrl.numeroInt,model.calle=ctrl.calle,model.colonia=ctrl.colonia,model.cp=ctrl.cp,model.municipio=ctrl.municipio,model.estado=ctrl.estado,model.rubro=ctrl.rubro,model.noContrato=ctrl.noContrato,model.uniquename=ctrl.uniquename,model.cliente=ctrl.cliente,model.telCliente=ctrl.telCliente,model.correoCliente=ctrl.correoCliente,model.fechaContrato=ctrl.fechaContrato,model.fechaVencimiento=ctrl.fechaVencimiento,model.pago=ctrl.pago,model.password=ctrl.password;model.userId=ctrl.userId;return model};return function(){return new ModelFactory}}])})();(function(){var app=angular.module("app");var depArr=["$routeParams","$location","mapFactory","modelFactory","paginasProxy","$anchorScroll"];depArr.push(function($route,$location,mapFactory,modelFactory,paginasProxy,$anchorScroll){var ctrl=this;ctrl.scrollTo=function(id){$location.hash(id);$anchorScroll()};ctrl.negocio=$route.negocio;var modelInstance=modelFactory();ctrl.getOne=function(name,userId){paginasProxy.getByUniqueName(name,function(data){var obj=modelInstance.getObjFromSubdocument(data[0]);ctrl=modelInstance.copyObjToCtrl(obj,ctrl);var latitud=parseFloat(ctrl.lat);var longitud=parseFloat(ctrl.long);var mapa=mapFactory(latitud,longitud);mapa.placeMarker(latitud,longitud)})};ctrl.getOne(ctrl.negocio)});app.controller("NegocioController",depArr)})();(function(){var app=angular.module("app");arrDep=["$routeParams","$location","mapFactory","productosFactory","paginasProxy","usuariosProxy","linkFactory"];arrDep.push(function($route,$location,mapFactory,productosFactory,paginasProxy,usuariosProxy,linkFactory){var ctrl=this;ctrl.productos=[];ctrl.links=[];ctrl.remover=undefined;var mapa=mapFactory();mapa.getEventListener();ctrl.borrarMarker=function(){mapa.borrarMarker()};ctrl.quitarLogo=function(){ctrl.logotipo=undefined};ctrl.quitarFoto=function(){ctrl.foto=undefined};var prod=productosFactory();ctrl.agregarProducto=function(){ctrl.producto=prod.agregarProducto(ctrl.productos,ctrl.producto)};ctrl.removerProducto=function(){ctrl.productos=prod.removerProducto(ctrl.productos,ctrl.remover)};ctrl.borrarProductos=function(){ctrl.productos=prod.borrarProductos(ctrl.productos)};var linkObj=linkFactory();ctrl.agregarLink=function(){ctrl.link=linkObj.agregarLink(ctrl.links,ctrl.link)};ctrl.removerLink=function(){ctrl.links=linkObj.removerLink(ctrl.links,ctrl.numLinkARemover)};ctrl.borrarLinks=function(){ctrl.links=linkObj.borrarLinks(ctrl.links)};ctrl.save=function(){ctrl.lat=mapa.getLat();ctrl.long=mapa.getLong();ctrl.userId=$route.id;paginasProxy.savePublico(ctrl.userId,ctrl,function(data,status,headers,config){alert("Su página web esta registrada, ahora la puede buscar en nuestra lista de negocios. Gracias.");$location.path("/")})};ctrl.noGuardar=function(){ctrl.userId=$route.id;usuariosProxy.delete(ctrl.userId,function(data,status,headers,config){alert("Todos sus datos tanto públicos como privados han sido borrados.");$location.path("/")})}});app.controller("NuevoPublicoController",arrDep)})();(function(){var app=angular.module("app");app.factory("paginasProxy",["proxyFactory","constants",function(proxyFactory,constants){var proxy=proxyFactory(constants.server+"/paginaWeb/api/");return proxy}])})();(function(){var app=angular.module("app");app.factory("productosFactory",[function(){var ProductosClass=function(){};ProductosClass.prototype.removerProducto=function(arr,producto){var sonDiferentes=function sonDiferentes(element,index,array){return index!==producto-1};arr=arr.filter(sonDiferentes);return arr};ProductosClass.prototype.agregarProducto=function(arr,producto){if(producto){arr.push(producto);producto=undefined;return producto}};ProductosClass.prototype.borrarProductos=function(productos){productos=[];return productos};return function(){return new ProductosClass}}])})();(function(){var app=angular.module("app");app.factory("proxyFactory",["$http","$log",function($http,$log){var Proxy=function(url){this.url=url};Proxy.prototype.error=function(data,status,headers,config){$log.error("%s %s %s",config.method,config.url,status)};Proxy.prototype.getAll=function(success){var that=this;$http({method:"GET",url:that.url}).success(success).error(that.error)};Proxy.prototype.getByUniqueName=function(name,success){var that=this;var completeUrl=that.url+"pages/"+name;$http({method:"GET",url:completeUrl}).success(success).error(that.error)};Proxy.prototype.getOne=function(id,success){var that=this;$http({method:"GET",url:that.url+id}).success(success).error(that.error)};Proxy.prototype.save=function(model,success){var that=this;$http({method:"POST",url:that.url,data:model}).success(success).error(that.error)};Proxy.prototype.update=function(id,model,success){var that=this;$http({method:"PUT",url:that.url+id,data:model}).success(success).error(that.error)};Proxy.prototype.delete=function(id,success){var that=this;$http({method:"DELETE",url:that.url+id}).success(success).error(that.error)};Proxy.prototype.savePublico=function(id,model,success){var that=this;$http({method:"POST",url:that.url+id,data:model}).success(success).error(that.error)};return function(url){return new Proxy(url)}}])})();(function(){var app=angular.module("app");app.factory("routeChecker",["$location",function($location){var RouteChecker=function(){this.privatePages=["/privado/todos","/privado/nuevo","/privado/editar","/privado/ver"];this.url=""};RouteChecker.prototype.isPrivate=function(){this.url=$location.path();for(i=0;i<this.privatePages.length;i++){var str=this.privatePages[i];if(this.url.indexOf(str)>-1)return true}return false};RouteChecker.prototype.isActive=function(path){return path===$location.path()};return function(){return new RouteChecker}}])})();(function(){var app=angular.module("app");app.controller("SigninController",["adminsProxy","$location","tokenStorage",function(proxy,$location,tokenStorage){var ctrl=this;ctrl.email="";ctrl.password="";ctrl.callback=function(tokenObj){tokenStorage.setToken(tokenObj);$location.path("/privado/todos")};ctrl.signin=function(){proxy.signin(ctrl,ctrl.callback)}}])})();(function(){var app=angular.module("app");app.controller("SignupController",["adminsProxy","$location",function(proxy,$location){var ctrl=this;ctrl.email="";ctrl.password="";ctrl.signup=function(){proxy.signup(ctrl,function(){$location.path("/signin")})}}])})();(function(){var app=angular.module("app");app.controller("SignupPublicoController",["usuariosProxy","$location",function(proxy,$location){var ctrl=this;ctrl.callback=function(data){var userId=data._id;$location.path("/publico/nuevo/"+userId)};ctrl.signup=function(){ctrl.fechaRegistro=Date.now();proxy.signupPublico(ctrl,ctrl.callback)}}])})();(function(){var app=angular.module("app");app.controller("TodosAdminController",["$location","adminsProxy","tokenStorage",function($location,adminsProxy,tokenStorage){var ctrl=this;ctrl.searchText="";ctrl.admins=[];ctrl.getAll=function(){adminsProxy.getAll(function(data){ctrl.admins=data})};ctrl.getAll();ctrl.delete=function(id){adminsProxy.delete(id,function(){$location.path("/privado/todos/admin")})}}])})();(function(){var app=angular.module("app");app.controller("TodosController",["$location","paginasProxy","tokenStorage",function($location,paginasProxy,tokenStorage){var ctrl=this;ctrl.searchText="";ctrl.empresas=[];ctrl.emailUsuario="";ctrl.getAll=function(){paginasProxy.getAll(function(data){ctrl.empresas=data})};ctrl.getAll();ctrl.delete=function(id){paginasProxy.delete(id,function(){$location.path("/privado/todos")})};ctrl.getEmail=function(){ctrl.emailUsuario=tokenStorage.getEmail()};ctrl.getEmail()}])})();(function(){var app=angular.module("app");app.controller("TodosPublicoController",["paginasProxy","$anchorScroll","$location","mapFactory",function(paginasProxy,$anchorScroll,$location,mapFactory){var ctrl=this;ctrl.paginas=[];ctrl.searchText="";ctrl.scrollTo=function(id){$location.hash(id);$anchorScroll()};ctrl.getAll=function(){paginasProxy.getAll(function(data){ctrl.paginas=data;var latitud=parseFloat(19.412288699925995);var longitud=parseFloat(-102.0718502998352);var mapa=mapFactory(latitud,longitud);mapa.placeMarker(latitud,longitud)})};ctrl.getAll()}])})();(function(){var app=angular.module("app");app.controller("TodosUsuariosController",["$location","usuariosProxy","tokenStorage",function($location,usuariosProxy,tokenStorage){var ctrl=this;ctrl.searchText="";ctrl.usuarios=[];ctrl.emailUsuario="";ctrl.getAll=function(){usuariosProxy.getAll(function(data){ctrl.usuarios=data})};ctrl.getAll();ctrl.delete=function(id){usuariosProxy.delete(id,function(){$location.path("/privado/todos/usuarios")})};ctrl.getEmail=function(){ctrl.emailUsuario=tokenStorage.getEmail()};ctrl.getEmail()}])})();(function(){var app=angular.module("app");app.factory("tokenStorage",["$window",function($window){return{getToken:function(){var json=$window.localStorage.getItem("objToken");if(json)return JSON.parse(json);return undefined},setToken:function(data){$window.localStorage.setItem("objToken",JSON.stringify(data))},clearToken:function(){$window.localStorage.setItem("objToken","")},getAccessHeader:function(){var that=this;var tokenObj=that.getToken();if(tokenObj){return tokenObj.token}return""},getEmail:function(){var that=this;var tokenObj=that.getToken();if(tokenObj){return tokenObj.user.email}return"No hay email"},getId:function(){var that=this;var tokenObj=that.getToken();if(tokenObj){return tokenObj.user._id}return"No hay _id"}}}])})();(function(){var app=angular.module("app");app.factory("usuariosProxy",["proxyFactory","constants",function(proxyFactory,constants){var UsuariosProxy=function(){this.signupPublicoProxy=proxyFactory(constants.server+"/usuario/api/")};UsuariosProxy.prototype.signupPublico=function(model,success){this.signupPublicoProxy.save(model,success)};UsuariosProxy.prototype.getAll=function(callback){this.signupPublicoProxy.getAll(callback)};UsuariosProxy.prototype.delete=function(id,success){this.signupPublicoProxy.delete(id,success)};return new UsuariosProxy}])})();(function(){var app=angular.module("app");var depArr=["$routeParams","mapFactory","modelFactory","paginasProxy"];depArr.push(function($route,mapFactory,modelFactory,paginasProxy){var ctrl=this;ctrl.empresaId=$route.id;var modelInstance=modelFactory();ctrl.getOne=function(id){paginasProxy.getOne(id,function(data){var obj=modelInstance.getObjFromSubdocument(data);ctrl=modelInstance.copyObjToCtrl(obj,ctrl);var latitud=parseFloat(ctrl.lat);var longitud=parseFloat(ctrl.long);var mapa=mapFactory(latitud,longitud);mapa.placeMarker(latitud,longitud)})};ctrl.getOne(ctrl.empresaId)});app.controller("VerController",depArr)})();